<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mavis Wong, Yasmin Hassan, Abeba N. Turi">
<meta name="dcterms.date" content="2024-12-06">

<title>P2P Online Lending Default Prediction- A Usecase on LendingClub Default Risk</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="p2p_lending_risk_analysis_report_files/libs/clipboard/clipboard.min.js"></script>
<script src="p2p_lending_risk_analysis_report_files/libs/quarto-html/quarto.js"></script>
<script src="p2p_lending_risk_analysis_report_files/libs/quarto-html/popper.min.js"></script>
<script src="p2p_lending_risk_analysis_report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="p2p_lending_risk_analysis_report_files/libs/quarto-html/anchor.min.js"></script>
<link href="p2p_lending_risk_analysis_report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="p2p_lending_risk_analysis_report_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="p2p_lending_risk_analysis_report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="p2p_lending_risk_analysis_report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="p2p_lending_risk_analysis_report_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary">1. Summary<br></a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">2. Introduction <br></a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">3. Methods <br></a>
  <ul>
  <li><a href="#data-source" id="toc-data-source" class="nav-link" data-scroll-target="#data-source">3.1 Data Source</a></li>
  <li><a href="#feature-description" id="toc-feature-description" class="nav-link" data-scroll-target="#feature-description">3.2 Feature Description</a></li>
  </ul></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">4. Analysis <br></a>
  <ul>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">4.1 Exploratory Data Analysis</a>
  <ul>
  <li><a href="#loan-categories" id="toc-loan-categories" class="nav-link" data-scroll-target="#loan-categories">4.1.1 Loan categories</a></li>
  <li><a href="#risk-categories" id="toc-risk-categories" class="nav-link" data-scroll-target="#risk-categories">4.1.2 Risk categories</a></li>
  <li><a href="#descriptive-analysis" id="toc-descriptive-analysis" class="nav-link" data-scroll-target="#descriptive-analysis">4.1.3 Descriptive Analysis</a></li>
  <li><a href="#correlation-analysis" id="toc-correlation-analysis" class="nav-link" data-scroll-target="#correlation-analysis">4.1.4 Correlation Analysis</a></li>
  </ul></li>
  <li><a href="#model-building" id="toc-model-building" class="nav-link" data-scroll-target="#model-building">4.2 Model Building <br></a>
  <ul>
  <li><a href="#data-splitting" id="toc-data-splitting" class="nav-link" data-scroll-target="#data-splitting">4.2.1 Data Splitting</a></li>
  <li><a href="#classification-metrics" id="toc-classification-metrics" class="nav-link" data-scroll-target="#classification-metrics">4.2.2 Classification Metrics</a></li>
  <li><a href="#model-selection" id="toc-model-selection" class="nav-link" data-scroll-target="#model-selection">4.2.3 Model Selection</a></li>
  <li><a href="#hyperparameter-optimization" id="toc-hyperparameter-optimization" class="nav-link" data-scroll-target="#hyperparameter-optimization">4.2.4 Hyperparameter Optimization</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#discussion-and-implications" id="toc-discussion-and-implications" class="nav-link" data-scroll-target="#discussion-and-implications">5. Discussion and Implications</a>
  <ul>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation">5.1 Model Evaluation</a></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations">5.2 Limitations</a></li>
  </ul></li>
  <li><a href="#reference" id="toc-reference" class="nav-link" data-scroll-target="#reference">6. Reference</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="../p2p_lending_risk_analysis_report.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">P2P Online Lending Default Prediction- A Usecase on LendingClub Default Risk</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Mavis Wong, Yasmin Hassan, Abeba N. Turi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 6, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="summary" class="level1">
<h1>1. Summary<br></h1>
<p>This work intends to leverage machine learning models to predict borrower behavior and, hence, the probability of default. More specifically, the work focuses on predicting loan defaults using historical data from the Lending Club platform. We uncover patterns and trends in borrower risk profiles by applying advanced preprocessing techniques, exploratory data analysis (EDA), and a Logistic Regression model. The final model demonstrated strong performance on unseen test data, achieving an accuracy of 84.0%. Out of 1,916 test cases, the model correctly predicted 1,608 cases, with 308 incorrect predictions. These errors included both false positives (predicting a loan default when it didn’t occur) and false negatives (failing to predict an actual default). While false negatives pose a greater risk in financial decision-making, this model provides actionable insights to improve risk management and reduce potential financial losses for the platform. Despite its promising predictive capabilities, further research is needed to enhance the model’s accuracy and better understand the characteristics of misclassified loans. Such improvements could play a crucial role in minimizing financial risks and maximizing the model’s effectiveness in peer-to-peer lending platforms</p>
</section>
<section id="introduction" class="level1">
<h1>2. Introduction <br></h1>
<p>Crowd-based business models are one of the last decade’s developments with the proliferation of platform economies and web technology applications <span class="citation" data-cites="sutherland2018sharing">(<a href="#ref-sutherland2018sharing" role="doc-biblioref">Sutherland and Jarrahi 2018</a>)</span>. One of such developments following the 2007 financial crisis are the P2P online lending platforms. The backbone of the digital economic system built on this relies on trust as a currency. Like all other crowd-based business models, P2P online lending heavily relied on the trustworthiness of borrowers <span class="citation" data-cites="lenz2016peer">(<a href="#ref-lenz2016peer" role="doc-biblioref">Lenz 2016</a>)</span>. To help with this, online platforms like LendingClub used several features to define eligibility and rate of access to loans for potential borrowers. Traditional credit risk analysis often relies on rule-based systems or credit scores, which might not fully capture the complexities of borrower behavior. By applying Logistic Regression, we aim to develop a model that is both interpretable and effective in identifying high-risk loans, see <span class="citation" data-cites="khandani2010consumer">(<a href="#ref-khandani2010consumer" role="doc-biblioref">Khandani, Kim, and Lo 2010</a>)</span>. This analysis intends to provide a data-driven approach to improve credit decision-making in a broader context of platform-based transactions through machine learning models.</p>
<p>Extensive research has been conducted on borrower risk behavior analysis and trust within P2P online lending systems, highlighting the critical role of trust and predictability in ensuring platform sustainability and mitigating default risks <span class="citation" data-cites="cai2016judging">(<a href="#ref-cai2016judging" role="doc-biblioref">Cai et al. 2016</a>)</span>. Building on these, this work focuses on developing a comprehensive risk analysis framework through machine learning models that will help predict borrower behavior.</p>
<p>This work will address the following research questions. - How do borrower characteristics influence the probability of default in a P2P online lending settings? - What techniques can improve machine learning models for predicting defaults in the presence of class imbalance?</p>
</section>
<section id="methods" class="level1">
<h1>3. Methods <br></h1>
<section id="data-source" class="level2">
<h2 class="anchored" data-anchor-id="data-source">3.1 Data Source</h2>
<p>This analysis is based on the historical loan data from LendingClub <span class="citation" data-cites="lendingclub">(<a href="#ref-lendingclub" role="doc-biblioref">matmcreative 2024</a>)</span>. It contains various borrower and loan features, such as interest rates, annual income, debt-to-income ratio (DTI), and credit history. The target variable, not.fully.paid, indicates whether the borrower defaulted on the loan (1) or successfully repaid it (0).</p>
</section>
<section id="feature-description" class="level2">
<h2 class="anchored" data-anchor-id="feature-description">3.2 Feature Description</h2>
<p>The key features taken into account for this analysis are shown below (See <a href="#tbl-feat_describ" class="quarto-xref">Table&nbsp;1</a>):</p>
<div id="tbl-feat_describ" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-feat_describ-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Feature Descriptions
</figcaption>
<div aria-describedby="tbl-feat_describ-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 77%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Variable</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>purpose</code></td>
<td>The purpose of the loan</td>
</tr>
<tr class="even">
<td><code>int.rate</code></td>
<td>Interest rate of the loan the applicant received</td>
</tr>
<tr class="odd">
<td><code>installment</code></td>
<td>Monthly payment for the loan the applicant received</td>
</tr>
<tr class="even">
<td><code>log.annual.inc</code></td>
<td>Annual income (growth rate)</td>
</tr>
<tr class="odd">
<td><code>dti</code></td>
<td>Debt-to-income ratio</td>
</tr>
<tr class="even">
<td><code>revol.bal</code></td>
<td>Total credit revolving balance</td>
</tr>
<tr class="odd">
<td><code>revol.util</code></td>
<td>Revolving line utilization rate</td>
</tr>
<tr class="even">
<td><code>inq.last.6mths</code></td>
<td>The number of inquiries in the past 6 months</td>
</tr>
<tr class="odd">
<td><code>delinq.2yrs</code></td>
<td>Delinquencies on lines of credit in the last 2 years</td>
</tr>
<tr class="even">
<td><code>pub.rec</code></td>
<td>The number of derogatory public records</td>
</tr>
<tr class="odd">
<td><code>fico</code></td>
<td>FICO credit score</td>
</tr>
<tr class="even">
<td><code>days.with.cr.line</code></td>
<td>Days with Credit Line</td>
</tr>
<tr class="odd">
<td><code>not.fully.paid</code></td>
<td>Binary response on whether the loan is paid or not</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
<section id="analysis" class="level1">
<h1>4. Analysis <br></h1>
<p>Python <span class="citation" data-cites="Python">(<a href="#ref-Python" role="doc-biblioref">Van Rossum and Drake 2009</a>)</span> language was used to conduct this analysis as well as the following packages: pandas<span class="citation" data-cites="pandas">(<a href="#ref-pandas" role="doc-biblioref">team 2020</a>)</span>, numpy<span class="citation" data-cites="numpy">(<a href="#ref-numpy" role="doc-biblioref">Harris et al. 2020</a>)</span>, matplotlib<span class="citation" data-cites="matplotlib">(<a href="#ref-matplotlib" role="doc-biblioref">Hunter 2007</a>)</span>, altair<span class="citation" data-cites="altair">(<a href="#ref-altair" role="doc-biblioref">VanderPlas 2018</a>)</span>, sklearn<span class="citation" data-cites="sklearn">(<a href="#ref-sklearn" role="doc-biblioref">Pedregosa et al. 2011</a>)</span>.</p>
<section id="exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis">4.1 Exploratory Data Analysis</h2>
<p>In order for us to draw context about the data, let us have a look at the first few rows of the data; check the info about all columns, data types, and number of NaN values (<a href="#tbl-info" class="quarto-xref">Table&nbsp;2</a>).</p>
<div class="cell" data-execution_count="3">
<div id="tbl-info" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="3">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-info-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Information on all numeric columns in training data.
</figcaption>
<div aria-describedby="tbl-info-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="3">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;"></th>
<th style="text-align: left;">Column</th>
<th style="text-align: right;">Non-Null</th>
<th style="text-align: left;">Dtype</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: left;">credit.policy</td>
<td style="text-align: right;">7662</td>
<td style="text-align: left;">int64</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">purpose</td>
<td style="text-align: right;">7662</td>
<td style="text-align: left;">object</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">int.rate</td>
<td style="text-align: right;">7662</td>
<td style="text-align: left;">float64</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">installment</td>
<td style="text-align: right;">7662</td>
<td style="text-align: left;">float64</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">log.annual.inc</td>
<td style="text-align: right;">7662</td>
<td style="text-align: left;">float64</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">dti</td>
<td style="text-align: right;">7662</td>
<td style="text-align: left;">float64</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">fico</td>
<td style="text-align: right;">7662</td>
<td style="text-align: left;">int64</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: left;">days.with.cr.line</td>
<td style="text-align: right;">7662</td>
<td style="text-align: left;">float64</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: left;">revol.bal</td>
<td style="text-align: right;">7662</td>
<td style="text-align: left;">int64</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: left;">revol.util</td>
<td style="text-align: right;">7662</td>
<td style="text-align: left;">float64</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">inq.last.6mths</td>
<td style="text-align: right;">7662</td>
<td style="text-align: left;">int64</td>
</tr>
<tr class="even">
<td style="text-align: right;">11</td>
<td style="text-align: left;">delinq.2yrs</td>
<td style="text-align: right;">7662</td>
<td style="text-align: left;">int64</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12</td>
<td style="text-align: left;">pub.rec</td>
<td style="text-align: right;">7662</td>
<td style="text-align: left;">int64</td>
</tr>
<tr class="even">
<td style="text-align: right;">13</td>
<td style="text-align: left;">not.fully.paid</td>
<td style="text-align: right;">7662</td>
<td style="text-align: left;">int64</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>To evaluate the usefulness of predictors for identifying loan defaults, we conducted an exploratory data analysis. (<a href="#fig-feature_dist" class="quarto-xref">Figure&nbsp;1</a>)</p>
<p>Features such as int.rate (interest rate) and dti (debt-to-income ratio) displayed notable differences between borrowers who fully paid their loans and those who defaulted. For example, loans with higher interest rates (int.rate) were associated with a greater likelihood of default, while borrowers with lower debt-to-income ratios (dti) were less likely to default.</p>
<p>Here, from a business perspective, we need to identify high-risk and low-risk loan profiles to improve lending profitability while minimizing default rates. This includes assessing borrower behavior, income stability, and loan utilization to create a predictive model for effective risk categorization <span class="citation" data-cites="cocser2019predictive">(<a href="#ref-cocser2019predictive" role="doc-biblioref">Coşer, Maer-Matei, and Albu 2019</a>)</span>.</p>
<div id="fig-feature_dist" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-feature_dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../results/figures/histograms_grid.png" class="img-fluid figure-img" style="width:120.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-feature_dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Empirical distributions of numerical features between class <code>Defaulted(1)</code> and <code>Fully Paid(0)</code>
</figcaption>
</figure>
</div>
<p>Here are some key metrics and considerations:</p>
<ul>
<li><p>Debt-to-Income Ratio</p></li>
<li><p>Credit Utilization Ratio( revol.util): how much of their revolving credit borrowers are using relative to their limit with higher values indicating possible financial strain.</p></li>
<li><p>Loan Duration vs.&nbsp;Risk: If longer-term loans are associated with higher default rate (days.with.cr.line).</p></li>
</ul>
<section id="loan-categories" class="level3">
<h3 class="anchored" data-anchor-id="loan-categories">4.1.1 Loan categories</h3>
<p>Below, to help us create the loan categories, we are using the FICO risk profile categories <span class="citation" data-cites="ConsumerBureau">(<a href="#ref-ConsumerBureau" role="doc-biblioref">Consumer Financial Protection Bureau 2024</a>)</span> See also <span class="citation" data-cites="myFICO">(<a href="#ref-myFICO" role="doc-biblioref">myFICO 2024</a>)</span> and <span class="citation" data-cites="Equifax">(<a href="#ref-Equifax" role="doc-biblioref">Equifax 2024</a>)</span> for details on different ranges of credit.</p>
<ul>
<li><p>Deep subprime (credit scores below 580)</p></li>
<li><p>Subprime (credit scores of 580-619)</p></li>
<li><p>Near-prime (credit scores of 620-659)</p></li>
<li><p>Prime (credit scores of 660-719)</p></li>
<li><p>Super-prime (credit scores of 720 or above)</p></li>
</ul>
<p>Categorical features like purpose also provided significant insights (<a href="#fig-purpose_risk" class="quarto-xref">Figure&nbsp;2</a>): loans categorized under “small business” and “credit card” showed higher default rates compared to others, such as “home improvement.”</p>
<div id="fig-purpose_risk" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-purpose_risk-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../results/figures/loan_category_vs_purpose.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-purpose_risk-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Distribution of borrower’s loan purpose by their risk profile category
</figcaption>
</figure>
</div>
</section>
<section id="risk-categories" class="level3">
<h3 class="anchored" data-anchor-id="risk-categories">4.1.2 Risk categories</h3>
<p>Let us explore the data further with specific borrower risk profile categories. Based on the above five loan categories, we framed three main risk categories as high, medium and low-risk profiles with:</p>
<ul>
<li><p>Low Risk: credit score of at least 720</p></li>
<li><p>Medium Risk: credit score between 650 and 720</p></li>
<li><p>High Risk: credit score of 650.</p></li>
</ul>
<pre>
</pre>
<div id="fig-risk_dist" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-risk_dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../results/figures/risk_categories_distribution.png" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-risk_dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Bar Chart showing the distribution of borrower’s risk level
</figcaption>
</figure>
</div>
<p>From <a href="#fig-risk_dist" class="quarto-xref">Figure&nbsp;3</a>, we observed a high concentration of loans in the medium-risk category and a significant number of low-risk borrowers compared to the high-risk borrowers. <br></p>
</section>
<section id="descriptive-analysis" class="level3">
<h3 class="anchored" data-anchor-id="descriptive-analysis">4.1.3 Descriptive Analysis</h3>
<p>&nbsp;</p>
<div id="fig-fico_purpose" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fico_purpose-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../results/figures/boxplot_purpose.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fico_purpose-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Boxplot comparing borrower’s credit score by their loan purpose
</figcaption>
</figure>
</div>
<p>From <a href="#fig-fico_purpose" class="quarto-xref">Figure&nbsp;4</a>, we see that the low-risk borrowers have a lower average debt-to-income ratio as compared to the borrowers with medium and high-risk profiles, based on their fico score. Note also the outliers in FICO scores for the loan purpose of debt consolidation type.</p>
<div id="fig-dti_risk" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dti_risk-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../results/figures/boxplot_risk.png" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dti_risk-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Boxplot comparing borrower’s debt-to-income ratio by their risk level
</figcaption>
</figure>
</div>
<p>From <a href="#fig-dti_risk" class="quarto-xref">Figure&nbsp;5</a>, we see that the low risk borrowers have lower average debt-to-income-ratio as compared to the borrowers with medium and high risk profile, based on their fico score. Note also the outliers in FICO scores for the loan purpose of debt consolidation type.</p>
</section>
<section id="correlation-analysis" class="level3">
<h3 class="anchored" data-anchor-id="correlation-analysis">4.1.4 Correlation Analysis</h3>
<p>The EDA for most of the numerical columns produces no strong general trends. We see a higher correlation level between fico and revo.util, and that of fico and interest rate. (<a href="#fig-corr_map" class="quarto-xref">Figure&nbsp;6</a>)</p>
<pre>
</pre>
<div id="fig-corr_map" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-corr_map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../results/figures/correlation_heatmap.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-corr_map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Heatmap showing correlation between features for the lending club data
</figcaption>
</figure>
</div>
<p><br></p>
</section>
</section>
<section id="model-building" class="level2">
<h2 class="anchored" data-anchor-id="model-building">4.2 Model Building <br></h2>
<section id="data-splitting" class="level3">
<h3 class="anchored" data-anchor-id="data-splitting">4.2.1 Data Splitting</h3>
<p>The dataset was split into training (80%) and test (20%) sets, resulting in 1916 observations in the test set. All numeric features were standardized using standardscaler, while categorical features were preprocessed using one-hot encoding before model fitting. Any missing values were imputed using the median for numeric features or the most frequent value for categorical features.</p>
</section>
<section id="classification-metrics" class="level3">
<h3 class="anchored" data-anchor-id="classification-metrics">4.2.2 Classification Metrics</h3>
<p>We decided to use the accuracy score as the classification metric. In financial decision-making, while false negatives impose greater financial risk to the platform, false positives can impose great financial strain on the borrower. Therefore, it is essential to identify both defaulted and fully paid loans correctly.</p>
</section>
<section id="model-selection" class="level3">
<h3 class="anchored" data-anchor-id="model-selection">4.2.3 Model Selection</h3>
<p>To decide on the most suitable classification model to build on, we have conducted a 10-fold cross-validation on four different classification models: DecisionTree, kNN-neighbours, SVC, and Logistic Regression.</p>
<div class="cell" data-execution_count="4">
<div id="tbl-cv_results" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="4">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-cv_results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Cross-validation results of various classification model.
</figcaption>
<div aria-describedby="tbl-cv_results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="4">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">fit_time</th>
<th style="text-align: left;">score_time</th>
<th style="text-align: left;">test_score</th>
<th style="text-align: left;">train_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0.111(+/-0.011)</td>
<td style="text-align: left;">0.004(+/-0.001)</td>
<td style="text-align: left;">0.737(+/-0.016)</td>
<td style="text-align: left;">1.000(+/-0.000)</td>
</tr>
<tr class="even">
<td style="text-align: left;">0.016(+/-0.001)</td>
<td style="text-align: left;">0.026(+/-0.042)</td>
<td style="text-align: left;">0.823(+/-0.008)</td>
<td style="text-align: left;">0.855(+/-0.001)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1.485(+/-0.027)</td>
<td style="text-align: left;">0.130(+/-0.002)</td>
<td style="text-align: left;">0.841(+/-0.002)</td>
<td style="text-align: left;">0.845(+/-0.000)</td>
</tr>
<tr class="even">
<td style="text-align: left;">0.026(+/-0.005)</td>
<td style="text-align: left;">0.003(+/-0.000)</td>
<td style="text-align: left;">0.839(+/-0.003)</td>
<td style="text-align: left;">0.840(+/-0.000)</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p><a href="#tbl-cv_results" class="quarto-xref">Table&nbsp;3</a> shows the mean validation score and training score for each model. We can see that the decision tree model has a much smaller cross-validation score compared to the other three models.</p>
<p>While the SVC model has a slightly larger test score than the logistic model, it requires a significantly longer computation time. Since the test score for SVC and Logistic Regression is very similar (both being ~0.84), We have opted for the logistic regression model as our predictor. The train score of the Logistic Regression is the same as the validation score, suggesting that the model is likely not overfitted and will be able to generalize well to unseen data.</p>
<p>The logistic Regression Model was selected as the final model to predict loan default risk due to its simplicity, slightly higher accuracy, and interpretability. All variables included in the original data set were used in model fitting.</p>
<p>&nbsp; &nbsp;</p>
</section>
<section id="hyperparameter-optimization" class="level3">
<h3 class="anchored" data-anchor-id="hyperparameter-optimization">4.2.4 Hyperparameter Optimization</h3>
<p>To find the optimal model for prediction, we used GridSearch to conduct 10-fold cross-validation over different values of the hyperparameter C. The regularization strength C is a hyperparameter that controls the trade-off between bias and variance. A high value of C corresponds to weaker regularization (less penalty on large coefficients), which might lead to overfitting, while a low value of C increases regularization and might underfit the model. We conduct GridSearch on a logarithmic range from <span class="math inline">\(10^{-5}\)</span> to <span class="math inline">\(10^{5}\)</span>. The range spanning a few orders of magnitude will ensure the model neither overfits nor underfits.</p>
<p>The results from the GridSearch were shown below (<a href="#fig-C_tuning" class="quarto-xref">Figure&nbsp;7</a>), with the optimal C value of 0.000687.</p>
<div id="fig-C_tuning" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-C_tuning-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../results/figures/param_C_tuning.png" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-C_tuning-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: 10-folds cross-validation results for hyperparameter C tuning. Accuracy score was used as the classification metric.
</figcaption>
</figure>
</div>
</section>
</section>
</section>
<section id="discussion-and-implications" class="level1">
<h1>5. Discussion and Implications</h1>
<section id="model-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation">5.1 Model Evaluation</h2>
<p>Our model performs well on the test data, achieving a test score of 0.8398.</p>
<p>Here, we identify the top 5 influential features for predicting each class (<a href="#tbl-positive_coef" class="quarto-xref">Table&nbsp;4</a>, <a href="#tbl-negative_coef" class="quarto-xref">Table&nbsp;5</a>,). The Logistic Regression’s coefficients have provided insights into feature importance, highlighting predictors such as higher credit score (<code>fico</code>) and larger income growth(<code>log.annual.inc</code>) to be associated with lower default risk. Meanwhile, borrowers with higher loan-to-income ratios, interest rates, and more inquiries in the past 6 months exhibited a greater likelihood of default.</p>
<p>&nbsp; &nbsp;</p>
<div class="cell" data-execution_count="5">
<div id="tbl-positive_coef" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="5">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-positive_coef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Top 3 influential feature for predicting class <code>Defaulted(1)</code>
</figcaption>
<div aria-describedby="tbl-positive_coef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="5">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">features</th>
<th style="text-align: right;">positive coefficient</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">num__fico</td>
<td style="text-align: right;">-0.1034</td>
</tr>
<tr class="even">
<td style="text-align: left;">num__credit.policy</td>
<td style="text-align: right;">-0.101</td>
</tr>
<tr class="odd">
<td style="text-align: left;">num__log.annual.inc</td>
<td style="text-align: right;">-0.0533</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>&nbsp; &nbsp;</p>
<div class="cell" data-execution_count="6">
<div id="tbl-negative_coef" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="6">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-negative_coef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5: Top 3 influential feature for predicting class <code>Fully Paid(0)</code>
</figcaption>
<div aria-describedby="tbl-negative_coef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="6">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">features</th>
<th style="text-align: right;">negative coefficient</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">num__int.rate</td>
<td style="text-align: right;">0.1193</td>
</tr>
<tr class="even">
<td style="text-align: left;">num__inq.last.6mths</td>
<td style="text-align: right;">0.1105</td>
</tr>
<tr class="odd">
<td style="text-align: left;">num__installment</td>
<td style="text-align: right;">0.0621</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>&nbsp; &nbsp;</p>
<p>The model correctly predicted 1608 cases out of 1916 on the test set, with 308 errors as shown in <a href="#tbl-confusion_matrix" class="quarto-xref">Table&nbsp;6</a>.</p>
<p>These errors were distributed across false positives and false negatives. False negatives, representing cases where a defaulted loan was not flagged, pose a greater financial risk, as these borrowers are likely to incur losses. False positives, on the other hand, might result in stricter lending requirements for borrowers who would have successfully repaid their loans.</p>
<p>&nbsp; &nbsp;</p>
<div class="cell" data-execution_count="7">
<div id="tbl-confusion_matrix" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="7">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-confusion_matrix-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6: Confusion Matrix of Logistic Regression Model on Test Data
</figcaption>
<div aria-describedby="tbl-confusion_matrix-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="7">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 30%">
<col style="width: 34%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Predict Positive (defaulted)</th>
<th style="text-align: right;">Predict Negative (fully paid)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">True Positive (defaulted)</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">306</td>
</tr>
<tr class="even">
<td style="text-align: left;">True Negative (fully paid)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1609</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>&nbsp; &nbsp;</p>
<p>Despite the high accuracy score, our model fails to identify any of the 306 actual default loans. This suggests that the accuracy score cannot fully reflect the model performance. However, our model is a great predictor in identifying negative loan defaults (over 99% of the fully paid cases identified), and the high false negative limits its real-life application. Further steps are needed to improve the model so that it can also predict defaulted loans well.</p>
<p>Future work will focus on improving the model’s ability to predict defaults by exploring methods for handling imbalanced datasets. One approach is to experiment with machine learning models designed to manage class imbalance better:</p>
<ol type="1">
<li><p>Data-level Adjustments: Undersampling to Reduce the number of majority class instances to balance the dataset; Oversampling: Increasing the number of minority class instances to achieve balance; Random Oversampling: Duplicating minority class instances at random; SMOTE: Generating synthetic examples of the minority class to train the model better; and</p></li>
<li><p>Training Procedure Adjustments like Stratified Splits, Class Weight Adjustment and Dynamic Resampling.</p></li>
</ol>
</section>
<section id="limitations" class="level2">
<h2 class="anchored" data-anchor-id="limitations">5.2 Limitations</h2>
<div class="cell" data-execution_count="8">
<div id="tbl-target_dist" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="8">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-target_dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;7: Target distribution showing class imbalance biased towards class <code>Fully Paid(0)</code>
</figcaption>
<div aria-describedby="tbl-target_dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="8">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">not.fully.paid</th>
<th style="text-align: right;">proportion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.839859</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.160141</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>As we check the distribution of the target, we can see that the proportion of borrowers who have repaid their loans is significantly higher than those who defaulted on their loans. The class imbalance of the target results in the model predicting most cases as “negative” (fully paid).</p>
<p>Possible solutions to the high false negtative include adjusting the <code>class_weight</code> hyperparameter or adjusting the decision threshold of the logistic model. Since accuracy might not fully reflect the model performance in the case of class imbalance, it would be good to include other evaluation metrics when evaluating model performance. A good alternative classification metrics would be the F1 score, as it minimises false positive and false negative while balancing the precision and recall.</p>
<p>Also, based on the feature importance obtained, additional feature engineering or feature selection can potentially improve model performance.</p>
<p>Another alternative is to use a non-linear classification model to account for possible non-linear decision boundaries. An example is a decision tree, which can better model complex non-linear decision boundaries.</p>
</section>
</section>
<section id="reference" class="level1 unnumbered">


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">6. Reference</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-cai2016judging" class="csl-entry" role="listitem">
Cai, Shun, Xi Lin, Di Xu, and Xin Fu. 2016. <span>“Judging Online Peer-to-Peer Lending Behavior: A Comparison of First-Time and Repeated Borrowing Requests.”</span> <em>Information &amp; Management</em> 53 (7): 857–67.
</div>
<div id="ref-ConsumerBureau" class="csl-entry" role="listitem">
Consumer Financial Protection Bureau. 2024. <em>Borrower Risk Profiles</em>. <a href="https://www.consumerfinance.gov/data-research/consumer-credit-trends/student-loans/borrower-risk-profiles/">https://www.consumerfinance.gov/data-research/consumer-credit-trends/student-loans/borrower-risk-profiles/</a>.
</div>
<div id="ref-cocser2019predictive" class="csl-entry" role="listitem">
Coşer, Alexandru, Monica Mihaela Maer-Matei, and Crişan Albu. 2019. <span>“PREDICTIVE MODELS FOR LOAN DEFAULT RISK ASSESSMENT.”</span> <em>Economic Computation &amp; Economic Cybernetics Studies &amp; Research</em> 53 (2).
</div>
<div id="ref-Equifax" class="csl-entry" role="listitem">
Equifax. 2024. <em>What Are the Different Ranges of Credit</em>. <a href="https://www.equifax.com/personal/education/credit/score/articles/-/learn/credit-score-ranges/">https://www.equifax.com/personal/education/credit/score/articles/-/learn/credit-score-ranges/</a>.
</div>
<div id="ref-numpy" class="csl-entry" role="listitem">
Harris, Charles R, K Jarrod Millman, Stéfan J van der Walt, Ralf Gommers, Pauli Virtanen, David Cournapeau, Eric Wieser, et al. 2020. <span>“<span class="nocase">Array programming with NumPy</span>.”</span> <em>Nature</em> 585 (7825): 357–62. <a href="https://doi.org/10.1038/s41586-020-2649-2">https://doi.org/10.1038/s41586-020-2649-2</a>.
</div>
<div id="ref-matplotlib" class="csl-entry" role="listitem">
Hunter, J. D. 2007. <span>“Matplotlib: A 2D Graphics Environment.”</span> <em>Computing in Science &amp; Engineering</em> 9 (3): 90–95. <a href="https://doi.org/10.1109/MCSE.2007.55">https://doi.org/10.1109/MCSE.2007.55</a>.
</div>
<div id="ref-khandani2010consumer" class="csl-entry" role="listitem">
Khandani, Amir E, Adlar J Kim, and Andrew W Lo. 2010. <span>“Consumer Credit-Risk Models via Machine-Learning Algorithms.”</span> <em>Journal of Banking &amp; Finance</em> 34 (11): 2767–87.
</div>
<div id="ref-lenz2016peer" class="csl-entry" role="listitem">
Lenz, Rainer. 2016. <span>“Peer-to-Peer Lending: Opportunities and Risks.”</span> <em>European Journal of Risk Regulation</em> 7 (4): 688–700.
</div>
<div id="ref-lendingclub" class="csl-entry" role="listitem">
matmcreative. 2024. <em>Lending-Club-Loan-Analysis</em>. <a href="https://github.com/matmcreative/Lending-Club-Loan-Analysis">https://github.com/matmcreative/Lending-Club-Loan-Analysis</a>.
</div>
<div id="ref-myFICO" class="csl-entry" role="listitem">
myFICO. 2024. <em>What’s in My FICO® Scores?</em> <a href="https://www.myfico.com/credit-education/whats-in-your-credit-score#:~:text=FICO%20Scores%20are%20calculated%20using,and%20credit%20mix%20(10%25">https://www.myfico.com/credit-education/whats-in-your-credit-score#:~:text=FICO%20Scores%20are%20calculated%20using,and%20credit%20mix%20(10%25</a>.
</div>
<div id="ref-sklearn" class="csl-entry" role="listitem">
Pedregosa, F., G. Varoquaux, A. Gramfort, V. Michel, B. Thirion, O. Grisel, M. Blondel, et al. 2011. <span>“<span class="nocase">Scikit-learn: Machine Learning in Python</span>.”</span> <em>Journal of Machine Learning Research</em> 12: 2825–30.
</div>
<div id="ref-sutherland2018sharing" class="csl-entry" role="listitem">
Sutherland, Will, and Mohammad Hossein Jarrahi. 2018. <span>“The Sharing Economy and Digital Platforms: A Review and Research Agenda.”</span> <em>International Journal of Information Management</em> 43: 328–41.
</div>
<div id="ref-pandas" class="csl-entry" role="listitem">
team, The pandas development. 2020. <span>“Pandas-Dev/Pandas: Pandas.”</span> Zenodo. <a href="https://doi.org/10.5281/zenodo.3509134">https://doi.org/10.5281/zenodo.3509134</a>.
</div>
<div id="ref-Python" class="csl-entry" role="listitem">
Van Rossum, Guido, and Fred L. Drake. 2009. <em>Python 3 Reference Manual</em>. Scotts Valley, CA: CreateSpace.
</div>
<div id="ref-altair" class="csl-entry" role="listitem">
VanderPlas, Jake. 2018. <span>“Altair: Interactive Statistical Visualizations for Python.”</span> <em>Journal of Open Source Software</em> 3 (7825, 32): 1057. <a href="https://doi.org/10.21105/joss.01057">https://doi.org/10.21105/joss.01057</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>